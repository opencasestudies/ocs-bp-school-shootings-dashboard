---
title: "Fifty Years of School Shootings in the United States"
css: style.css
output:
  html_document:
    self_contained: yes
    code_download: yes
    highlight: tango
    number_sections: no
    theme: cosmo
    toc: yes
    toc_float: yes
  pdf_document:
    toc: yes
  word_document:
    toc: yes

---

<style>
#TOC {
  background: url("https://opencasestudies.github.io/img/logo.jpg");
  background-size: contain;
  padding-top: 240px !important;
  background-repeat: no-repeat;
}
</style>


<!-- Open all links in new tab-->  
<!-- <base target="_blank"/>   -->

```{r setup, include=FALSE}
knitr::opts_chunk$set(include = TRUE, comment = NA, echo = TRUE,
                      message = FALSE, warning = FALSE, cache = FALSE,
                      fig.align = "center", out.width = '90%')
library(here)
library(knitr)
```

#### {.outline }
```{r, echo=FALSE}
knitr::include_graphics(here("screenshots",
                             "final_plot.png"))
```
####

#### {.disclaimer_block}

**Disclaimer**: The purpose of the [Open Case Studies](https://opencasestudies.github.io){target="_blank"} project is **to demonstrate the use of various data science methods, tools, and software in the context of messy, real-world data**. A given case study does not cover all aspects of the research process, is not claiming to be the most appropriate way to analyze a given data set, and should not be used in the context of making policy decisions without external consultation from scientific experts. 

####

#### {.license_block}

This work is licensed under the Creative Commons Attribution-NonCommercial 3.0 [(CC BY-NC 3.0)](https://creativecommons.org/licenses/by-nc/3.0/us/){target="_blank"}  United States License.

####

#### {.reference_block}

To cite this case study please use:

Wright, Carrie, and Ontiveros, Michael and Jager, Leah and Taub, Margaret and Hicks, Stephanie. (2020). https://github.com/opencasestudies/ocs-youth-school-shootings-dashboard-case-study. Fifty Years of School Shootings in the United States (Version v1.0.0).

####

## **Motivation**
*** 

This case study is motivated by this [article](https://link.springer.com/content/pdf/10.1007/s11920-012-0331-6.pdf):

#### {.reference_block}

Flannery, D. J., Modzeleski, W. & Kretschmar, J. M. Violence and School Shootings. Curr Psychiatry Rep 15, 331 (2013). DOI: [10.1007/s11920-012-0331-6](https://doi.org/10.1007/s11920-012-0331-6)

####

This article explores characteristics of school shootings and violence in schools and discusses why these events may occur, as well as their impact on the communities in which they occur.



This article states that the shooters of most commonly white males, but that many previous studies of shooter characterisitcs could not identify any particular "profile" of shooters.

> "To date, studies of school shootings have concluded that no
consistent and reliable profile of school shooters exist, and
most researchers and clinicians would agree that predicting
violent behavior is a slippery slope that will usually result in
more false positives than false negatives."

However previous studies note some commonalites such as:

> "...most shooters were depressed, had experienced some significant
loss, felt persecuted or bullied by others, and had prior
difficulty coping or had previously tried suicide. Most of
the shooters did not, however, have a history of drug abuse
or violence or cruelty to animals, common psychiatric indicators of risk, nor did they report excessive exposure to
violence in the media (though many produced their own
violent themes in writings or drawings)."


```{r, echo = FALSE, out.width= "60%"}
knitr::include_graphics(here::here("img", "joshua-hoehne-CAokgx1GGKE-unsplash.jpg"))
```


<span>Photo by <a href="https://unsplash.com/@mrthetrain?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Joshua Hoehne</a> on <a href="https://unsplash.com/s/photos/high-school?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a></span>



> "School shootings are not all the same and may require
different approaches to prevention and treatment, especially
with respect to identifying risk factors at the individual, school
or community levels, and particularly with regard to examining
the role that mental health issues may play to increase risk for
perpetration. The field **needs to know more** about shooting
incidents that are averted, those that result in injury but not
death and about the characteristics of the more common occurrence of single homicide school shootings."


```{r, echo = FALSE, out.width= "60%"}
knitr::include_graphics(here::here("img", "andre-hunter-AQ908FfdAMw-unsplash.jpg"))
```

<span>Photo by <a href="https://unsplash.com/@dre0316?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Andre Hunter</a> on <a href="https://unsplash.com/s/photos/high-school?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a></span>


They also point out that:

> "Most media attention is on the mental health of school shooters, but we cannot forget the **impact of school shooting incidents on the surviving victims**, including those who may not have been injured but who may have witnessed the incident or been affected by it in other ways. Psychiatrists must pay attention to the long-term mental health consequences of these incidents on all affected parties (not just formal PTSD diagnoses, but related trauma symptoms) as well as maladaptive coping strategies that some may employ in response to such unpredictable, tragic events."

Given this need for more research to better understand why these events occur and how they could be averted, in this case study we will demonstrate how to create a resource for others to more easily and interactively access data about school shootings. To do so we will create what is called a [dashboard](https://en.wikipedia.org/wiki/Dashboard_(business)), which is a website that displays a report for a database. Dashboards summarize the data in a database and typically allow for users to interact with the data in some way.


## **Main Questions**
*** 

#### {.main_question_block}
<b><u> Our main questions: </u></b>

1) What has been the yearly rate of school shootings and where have they occurred in the last 50 years (from January 1970 to June 2020)? 

2) What are the characteristics of these events?

####

## **Learning Objectives** 
*** 

In this case study, we will demonstrate how to create a [dashboard](https://en.wikipedia.org/wiki/Dashboard_(business)), which is a website that displays a report about a database. We will especially focus on using packages and functions from the [`Tidyverse`](https://www.tidyverse.org/){target="_blank"}, such as `package_name`, `package_name`. The tidyverse is a library of packages created by RStudio. While some students may be familiar with previous R programming packages, these packages make data science in R more legible and intuitive.


```{r, out.width = "20%", echo = FALSE, fig.align ="center"}
include_graphics("https://tidyverse.tidyverse.org/logo.png")
```

The skills, methods, and concepts that students will be familiar with by the end of this case study are:

Avocado update here and in readme!

Data science skills:  

1. Importing text from a google sheets document???
2. Apply action verbs in `dplyr` for data wrangling  
3. How to reshape data by pivoting between "long" and "wide" formats and separating columns into additional columns (`tidyr`)  
4. How to fill in data based on previous values (`tidyr`)
5. How to create data visualizations with `ggplot2` that are in a similar style to an existing image    
6. How to add images to plots using `cowplot`
7. How to create effective bar plots to for multiple comparisons, including adding gaps between bars in bar plots, adding figure legends to the plot area, and adding comparison lines (`ggplot2`)

Statistical concepts and methods:  


*** 


We will begin by loading the packages that we will need:


```{r}
library(here)
library(readr)
library(dplyr)
library(flexdashboard)
library(shiny)
library(tidyverse)
library(leaflet)
library(sf)
library(rmapshaper)
library(htmltools)
library(lubridate)
library(DT)
```


 <u>**Packages used in this case study:** </u>

Package   | Use in this case study                                                                      
---------- |-------------
[here](https://github.com/jennybc/here_here){target="_blank"}       | to easily load and save data  
[readr](https://readr.tidyverse.org/) |  to import the data    
[dplyr](https://dplyr.tidyverse.org/){target="_blank"}      | to filter, subset, join, add rows to, and modify the data    
[stringr](https://stringr.tidyverse.org/){target="_blank"}      | to manipulate  character strings within the data
[magrittr](https://magrittr.tidyverse.org/){target="_blank"}      | to pipe sequential commands 
[ggmap](https://cran.r-project.org/web/packages/ggmap/ggmap.pdf) | to geocode the data (which means get the latitude and longitude values for the schools)
[flexdashboard](https://rmarkdown.rstudio.com/flexdashboard/)     | to create the elements of the dashboard 

[tidyr](https://tidyr.tidyverse.org/){target="_blank"}      | to change the shape or format of tibbles to wide and long, to drop rows with `NA` values, to separate a column into additional columns, and to fill out values based on previous values   
[shiny](https://shiny.rstudio.com/gallery/){target="_blank"}      | to avocado  
[leaflet](https://rstudio.github.io/leaflet/shiny.html) | to implement the create the map for our dashboard   
[sf](https://r-spatial.github.io/sf/) | to Geocode the data avocado
[rmapshapper](https://cran.r-project.org/web/packages/rmapshaper/vignettes/rmapshaper.html) | avocado
[htmltools](https://www.rdocumentation.org/packages/htmltools/versions/0.5.0) | to avocado   
[lubridate](https://lubridate.tidyverse.org/) | to work with the data-time data    
[DT](https://rstudio.github.io/DT/) | to create the interactive table  
[ggplot2](https://ggplot2.tidyverse.org/){target="_blank"}      | to create plots  
[directlabels](http://directlabels.r-forge.r-project.org/docs/index.html){target="_blank"}      | to add labels directly to lines in plots  
[cowplot](https://cran.r-project.org/web/packages/cowplot/vignettes/introduction.html){target="_blank"}      | to add images to plots 
[forcats](https://forcats.tidyverse.org/){target="_blank"}      | to reorder factor for plot

[patchwork](https://github.com/thomasp85/patchwork) | to combine plots



The first time we use a function, we will use the `::` to indicate which package we are using. Unless we have overlapping function names, this is not necessary, but we will include it here to be informative about where the functions we will use come from.


## **Context**
*** 

Although school shooting events that result in homicide are rare, they can have a lasting impact on the communities in which they occur. Furthermore, suicide events and shootings with no victims can also be impactful.

According to the [Center for Injury Research and Prevention at the Children's Hospital of Philadelphia](https://injury.research.chop.edu/violence-prevention-initiative/types-violence-involving-youth/school-shootings):

>The most common shootings on school grounds rarely involve large numbers of victims, but even a shooting of just one student at school has ramifications far beyond those directly involved. Students and staff that witness school shootings are likely to suffer from [traumatic stress](https://en.wikipedia.org/wiki/Traumatic_stress) symptoms, become anxious or depressed and have general concerns about their safety. While many witnesses will have temporary symptoms, others will be symptomatic for a much longer period of time and even develop chronic psychiatric disorders. Even short-term impairments can cause severe distress and have profound effects on academic achievement and the social and emotional growth of impacted students. 
 
Furthermore, fatal shootings can have vast and lasting impacts because many students can witness a single event.

Another recently published [article](https://siepr.stanford.edu/sites/default/files/publications/19-036.pdf) indicates that:

> Over **240,000** American students experienced a school shooting in the last two decades.


```{r}
knitr::include_graphics(here::here("img", "exposed.png"))

```

##### [[source]](https://siepr.stanford.edu/sites/default/files/publications/19-036.pdf)
 
This study followed students who experienced a school shootting the United States between 2008 and 2013 and assessed their mental well-being. They found that:

> Fatal school shootings have large and persistent impacts on the mental health of local youth. In the two years following a fatal school shooting, the monthly number of antidepressant prescriptions written to individuals under age 20 is 21.3 percent higher in the shooting-exposed relative to the reference areas. 

```{r, echo = FALSE, outwidth = "40%"}
knitr::include_graphics(here::here("img", "fernando-cferdo-6x2iKGi6SPU-unsplash.jpg"))
```

<span>Photo by <a href="https://unsplash.com/@cferdo?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Fernando @cferdo</a> on <a href="https://unsplash.com/s/photos/depression?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a></span>


#### {.reference_block}

Rossin-Slater, M., Schnell, M., Schwandt, H., Trejo, S. & Uniat, L. Local Exposure to School Shootings and Youth Antidepressant Use. w26563 http://www.nber.org/papers/w26563.pdf (2019) doi:10.3386/w26563.

####
 
## **Limitations**
*** 
There are some important considerations regarding this data analysis to keep in mind: 

1) This analysis is exploratory and, as such, does not intend to provide inferential conlcusions.  

2) This dashboard only uses one source of data. There may be school shooting events that are not listed in this data or errors in this data.

According to the database website:

>"This database was developed from open-source information and may include reporting errors."

Furthermore, according to this [article](https://link.springer.com/article/10.1007/s11920-012-0331-6) schools are not required to report school shootings unless they resulted in a suicide or homicide, therefore there may be more events that result in only injury or no injuries or death that may not be included.

There are indeed events in the dataset that include zero deaths and zero injuries, but it is very likely that many of these events are not listed.

Avocado... this source from 2013 says that schools are not required to report.. is this still true?


## **What are the data?**
*** 

We will use data from the open-source [K-12 ShoolShooting Database](https://www.chds.us/ssdb/dataset/) downloaded from the [Center for Homeland Defense and Security](https://www.chds.us/c/) at the at the [Naval Postgraduate School(NPS)](https://en.wikipedia.org/wiki/Naval_Postgraduate_School) in Monterey, California. This data is updated daily. 

#### {.reference_block}

Riedman, David, and Desmond O’Neill. “CHDS – K-12 School Shooting Database.” Center for Homeland Defense and Security, June 2020, [www.chds.us/ssdb](www.chds.us/ssdb).

####

This database includes information about school shooting events in the United States dating back to 1970. The database has additional information not shown on our dashboard including but not limited to: 

- Location of the event at the school  
- If the event occured during a sporting event  
- Time of day of the event  
- Day of the week of the event  
- source for the shooting information  
- If the event was pre-planned or not  
- Shooter's actions immediately following the shooting  
- Shooter characteristics (affiliation with the school, if they had accomplices, if they took hostages, and their age and race)  
- victom characteristics(afficliation with the school, if they were targeted, their age and race)  

According to the data base website:

> The School Shooting Database Project is conducted as part of the [Advanced Thinking in Homeland Security (HSx)](https://www.chds.us/c/academic-programs/hsx/) program at the Naval Postgraduate School’s [Center for Homeland Defense and Security (CHDS)](Center for Homeland Defense and Security (CHDS).

>The database compiles information from more than 25 different sources including peer-reviewed studies, government reports, mainstream media, non-profits, private websites, blogs, and crowd-sourced lists that have been analyzed, filtered, deconflicted, and cross-referenced. All of the information is based on open-source information and 3rd party reporting.

## **Data Import**
*** 

To import the raw data file we will use the `read_csv()` function of the `readr` package. 

We will use the `here()` function of the `here` package to easily locate the data within the `raw_data` directory within the directory that contains the .Rproj file.

We want to skip the first row that states:
Updated 6/2/2020 - View graphs and research methodology on www.chds.us/ssdb If you have information about other incidents, please email K12ssdb@chds.us."

To do this, we can use the `skip` argument of this function and specify that we wish to only skip 1 row with `skip = 1`. We can also specify that the next row should be used for column names using the `col_names = TRUE` argument. 


```{r}

shooting_data <- readr::read_csv(file = here::here("raw_data", "K-12_SSDB_(Public)-K-12_SSDB_(Public)_Linked.csv"), col_names = TRUE, skip = 1)
```


We can use the `glimpse` function of the `dplyr` package to take a look at columns within the database:

#### {.scrollable }
```{r}
# Scroll through the output!
glimpse(shooting_data)
```

####

We can also use the utils `str()` function to see more detials about the values. Typically we would be able to see these with `glimpse()` but some of the columns have very long names, thus obscuring the first few values in the output.

#### {.scrollable }
```{r}
# Scroll through the output!
str(shooting_data)
```

####

## **Data Exploration and Wrangling**
***
Luckily, our data is already in pretty good shape, but we want to make our data more useful for our dashboard. 

We are interested in creating a map on our dashboard. 

To do so we need to perform a process called [geocoding](https://en.wikipedia.org/wiki/Geocoding). Geocoding is the process of converting addresses into latitude and longtitude coordinates.

### Geocoding with the `ggmap` oackage

To peform the geocoding we need the address of each school in the data set. The data currently does not list the actual address, but does have information about the school where the event occured. Since some schools have the same name, we need the city and state data as well. So we will create a new variable in our data called `address` using the `mutate()` function of the `dplyr` package. This variable will collapse the values in the `School`, `City`, and `State` columns but with spaces in between. It is specified that there will be space in between by the `sep = " "` argument. Note that a space is typed between the quotation marks. Then we can use the address variable to look up the latitude and longtitude for each school.


```{r}
shooting_data <- shooting_data %>%
  dplyr::mutate(address = 
          stringr::str_c(School, City, State, sep = " "))

```

Notice that we used a `%>%` in the previous chunk of code. This allows us to create code with a method called piping. 

It allows us to perform many sequential steps efficiently.

***
<details> <summary>Click here if you are unfamiliar with piping in R, which uses this `%>%` operator.</summary>  

By [piping](https://cran.r-project.org/web/packages/magrittr/vignettes/magrittr.html) we mean using the `%>%` pipe operator which is accessible after loading the `tidyverse` or several of the packages within the tidyverse like `dplyr` because they load the [`magrittr` package](https://cran.r-project.org/web/packages/magrittr/vignettes/magrittr.html). 
This allows us to perform multiple sequential steps on one data input.
The object on the left side is used as input to any commands to the right or below.

</details>  
***

We can take a look at just this new `address` variable using the `pull()` function of the `dplyr()` package.

#### {.scrollable }
```{r}
shooting_data %>%
  dplyr::pull(address)
```
#### 

Now we can use these addresses to find the latitude and longitude coordinates for each school where a school shooting occured. To do this we will use the `geocode` function of the `ggmap` package to look up these addresses on Google Maps to get the latitude and longitude values. In this command we need to specify that we want to use google as the source using the `source` argument and that we want latitude and longitude using the `output = c("latlon") argument.


This step requires registering with the Google Cloud Platform to get an API key, which currently requires registering your payment information and agreeing to the [Google Maps API Terms of Service](https://developers.google.com/maps/terms).

Therefore, we will simply demonstrate how this process works in general, but you are not required to do this yourself. 

<details><summary> Click here to see how we registered with the Google Cloud Platform.</summary>

If you were to do this process yourself, you could get an API key [here](https://cloud.google.com/maps-platform/). Again this requires registering your payment information, but it is free to got an API key and enable the APIs, however you can be billed based on how many addresses you look up using the APIs. You need to look up thousands before getting billed.

Then you need to enable the maps and places APIs, by clicking on the boxes next to each:

```{r,echo = FALSE}
knitr::include_graphics(here::here("img", "enable.png"))
```

Then you would register like so after copying the API key: (Note this is a fake key)

```{r, eval = FALSE}
ggmap::register_google(key = "mQkzTpiaLYjPqXQBotesgif3EfGL2dbrNVOrogg") 
```

***
</details>


Once we have obtained an API key and registered, we can geocode our data.

Note that this step is time intensive, as there are many addresses to look up! Therefore, we will just show how this is done.

```{r, eval=FALSE}

shooting_data <- shooting_data %>%
  mutate(coords = ggmap::geocode(address, output = c("latlon"),
                         source = c("google")))
```

This results in tibble called `coords` being added to our `shooting_data` tibble. That's right we can have a tibble as a column or variable within a tibble.   Using the `glimpse` function again, and looking at the last few variables, we can see that now the last variable listed is `coords` of class `<tibble>`.

```{r,echo = FALSE, out.width="70%"}
knitr::include_graphics(here::here("img", "shooting_data_coords.png"))
```

If we take a look at the first couple of values of the `coords` tibble, using the `slice_head()` function of the dplyr package, we see a tibble that looks like this:

```{r, eval = FALSE}
test %>%
 pull(coords) %>%
 dplyr::slice_head(n = 2)
```


```{r,echo = FALSE, out.width="40%"}
knitr::include_graphics(here::here("img", "coords.png"))
```


It would be better if each of these were their own columns in the tibble, so we will create new `longitude` and `latitude` variables again using the `mutate` function like so:

```{r, eval = FALSE}
shooting_data <- shooting_data %>%
  mutate(longitude = pull(coords,lon),
         latitude = pull(coords,lat))
```

In this case we use the `pull()` function to grab the `lat` and `lon` variables within the `coords` tibble which is a variable of the `shooting_data` tibble.

We can now remove the `coords` tibble like so, using the `select()` funtion of the `dplyr` package:

```{r, eval = FALSE}  
shooting_data <- shooting_data %>%
  dplyr::select(-coords)

```


Now using `glimpse()` and looking at the last several variables, we can see that we no longer have a `coords` variable, but we do have two variables calld `longitude` and `latitude` that are of class double as indicated by the `<dbl>`:

```{r,echo = FALSE, out.width="70%"}
knitr::include_graphics(here::here("img", "double.png"))
```


Now we will save the geocoded data in the `processed_data` directory using the `write_csv` function of the `readr` package.

This requires listing the R object, followed by the path for where the file should be saved and what it should be called. In this case it will be called "shooting_data.csv".

```{r, eval = FALSE} 
readr::write_csv(shooting_data, path = here("processed_data",
                              "shooting_data.csv"))
```


Great now we will work with this data, thus you do not need to get an API key to get to this point. We can read our processed geocoded data into R by using the `read_csv()` function of the `readr` package.

```{r}

shooting_data_geocoded <- read_csv(here("processed_data",
              "shooting_data.csv"))
```


### Geometry lists with the `sf` package

Now we will use the `sf` (which stands for simple features) package to 
create what is called a geometry list of our latitude and longitude  information for the schools where shootings occured. This will allow us to create a map of these events.
`crs` stands for coordinate reference system

```{r, eval = FALSE}
shooting_data_geocoded <- shooting_data_geocoded %>%
  filter(!is.na(longitude),
         !is.na(latitude)) %>%
  sf::st_as_sf(coords = c("longitude", "latitude"), crs = 4326) %>%
  st_transform(crs = 102008) %>%
  st_jitter(amount = 50) %>%
  st_transform(crs = 4326) %>%
  mutate(longitude = st_coordinates(.)[,1],
         latitude = st_coordinates(.)[,2]) %>%
  as_tibble() %>%
  dplyr::select(-geometry)

state_df <- as_tibble(cbind(state.abb, state.name))

shooting_data_geocoded <- shooting_data_geocoded %>%
  mutate(Date = as.Date(Date, format = "%m/%d/%Y")) %>%
  mutate(Date_year = year(Date)) %>%
  rename("State_abb" = State) %>%
  left_join(state_df, by = c("State_abb" = "state.abb")) %>%
  rename("State" = state.name) %>%
  mutate(State = str_to_title(tolower(State))) %>%
  mutate(`Suicide (or attempted suicide) by Shooter (Y/N)` = case_when(`Suicide (or attempted suicide) by Shooter (Y/N)` == "Yes" ~ TRUE,
                                                                       TRUE ~ FALSE))

start <- 1970
end <- 2020

write_csv(shooting_data_geocoded, path = here("processed_data",
                                              "shooting_data_wrangled.csv"))

rm(shooting_data_geocoded)

shooting_data_geocoded <- read_csv(here("processed_data",
                                        "shooting_data_wrangled.csv"))
```


Put files in docs directory and use `here` package.

## **Data Exploration and Wrangling**
*** 

INTRODUCE THE CONCEPT OF DASHBOARDS

INTRODUCE `flexdashboard`

## **Data Analysis**
*** 

## **Data Visualization**
*** 



## RA NOTES

### General Notes

Consult this document for a general overview:

+ case-study-structure-MO-notes

There are several datasets involved in this case study

+ Raw dataset (raw_data/K-12 SSDB (Public) - K-12 SSDB (Public) Linked.csv)
+ Geocoded dataset  (processed_data/shooting_data.csv)
+ Wrangled dataset (processed_data/shooting_data_wrangled)

This document uses the geocoded dataset to produce the wrangled dataset.

The wrangled dataset is then used to produce the dashboard in the other document.

Code to geocode and then wrangle the datasets are included in this document.

The goecoding required to produce this case study took approximately 1.5-2 hours on a Macbook Air (2015). 

The maps we created were largely restrictred to efficient maps. Maps with multiple layers required a lot of computational power which we chose not to use. 

### Important Links

[RStudio/flexdashboard](https://rmarkdown.rstudio.com/flexdashboard/)

[Leaflet](https://rstudio.github.io/leaflet/)

### Metadeta

Flexdashboard requires metadeta to work. A good example of what we did can be found on the layout section of the `RStudio/flexdashboard/Home` link included above. 

### Columns & Rows

In the metadata, we specify whether we want our output to be oriented in rows (left to right) or columns (top to bottom). If I created two plots with columnwise settings, the first plot will be at the top and the second at the bottom. If I do the same thing for rowwise settigns, the first plot will be on the left and the second plot will be on the right. Each time we specify a new column or row, the output is shown in this way in a specific column/row. See `Multiple Columns` and `Row Orientation` on the `RStudio/flexdashboard/Home` link included above for an example. 

We specify a column/row with this.

```
-------------------------------------
```

It does not matter whether you write column/row above that. The only thing that matters is the orientation set-up in the metadeta. 

orientation: columns is the default from my understanding.

You need to specify orientation: rows if you want rowwise orientation

You can add tabsets to columns/rows with: 

```
Column {.tabset}
```

See the Tabsets section on `RStudio/flexdashboard/Using` for clear examples of how this can be done.

### Graphics & Titles

Most plots can be plotted by specifying a title chunk with the title specified.

### Shiny

Shiny can be used with `flexdashboard`. Coding with packages that have shiny functionality requires shiny-specific code is shiny is enabled. In our case, shiny is enabled. Packages such as `DT` or `Leaflet` may operate differently as a result. 

### Leaflet

`Leaflet` widgets can be included within dashboards created with `flexdashboard`.

`Leaflet` works by provided by adding base data (such as a map) and then adding markers if desired in layers. This is very similar to how `ggplot` functions (pun intended).

The layers displayed can be controlled using a sort of legend. Depending on the type of layers, some information may be displayed mutually exclusive of the other layers; other layers (such as circles/general markers) can be toggled on and off. 

A minimap can be added.

The layers displayed when the widget is first opened can also be controlled. We did that in this case study. 

`groups` in leaflet can be thought of as layer-specific IDs that create labels for legends and allow specific layers to be referred to in separate functions. 

If we called a group "Layer 1" and then in a subsequent layer referred to "Layer 1", `Leaflet` will correctly identify which layer is being referenced.

`Leaflet` can require a lot of computational power; this can have an impact on the types of maps produced.

Clustering options can be applied to circles/markers. Some examples of this can be found on the bottom of [this page](https://rstudio.github.io/leaflet/markers.html).

```
### Specified Title
```

If the title is unspecified...

```
###
```

the graphics will be recognized but no title will be shown for that particular graphic.

`fig-width` and `fig.height` operate in the code chunk options. 

## RA Code

We will employ the following layout for the dashboard.

RMarkdown Dashboard Structure

+ Icon (48 x 48)
+ The Data
+ Column 1: Interactive Table
+ Column 2: Photo
+ US Statistics
+ Column 1 
+ Yearly Deaths
+ Yearly Cumulative Deaths
+ Deaths per Shooting
+ Column 2
+ Wounded
+ Deaths
+ Shooting Completed/Attempted Suicide
+ Median Shots Fired
+ Deaths, Shooter was Only Victim
+ Use of a Single Handgun
+ State Statistics
+ Sidebar
+ Column 1
+ Yearly Deaths
+ Yearly Cumulative Deaths
+ Deaths per Shooting
+ Map
+ Zoom (+)
+ Zoom (-)
+ Layer Controls
+ Provider Tiles
+ Circle Markers
+ Mini-map
+ About
+ Column 1
+ Disclaimer
+ How do I use this dashboard?
+ Does Open Case Studies have more resources I can access to learn about creating this dashboard?
+ Column 2: Photo
+ Tutorial
+ Step 1: Load the `flexdashboard` package
+ Step 2: Create and `RMD` document
+ Step 3: Create an appropriate `YAML`.
+ Step 4: Design the layout of the dashboard.
+ Step 5: Add content to the dashboard.
+ Hotline
+ Warning Signs
+ Response to Warning Signs
+ Source Code





```{r, eval=FALSE}
shooting_data_geocoded <- read_csv(here("processed_data",
              "shooting_data.csv"))

shooting_data_geocoded <- shooting_data_geocoded %>%
  filter(!is.na(longitude),
         !is.na(latitude)) %>%
  st_as_sf(coords = c("longitude", "latitude"), crs = 4326) %>%
  st_transform(crs = 102008) %>%
  st_jitter(amount = 50) %>%
  st_transform(crs = 4326) %>%
  mutate(longitude = st_coordinates(.)[,1],
         latitude = st_coordinates(.)[,2]) %>%
  as_tibble() %>%
  dplyr::select(-geometry)

DT_table <- shooting_data_geocoded %>%
  dplyr::select(Date,
                School,
                City,
                State,
                `Narrative (Detailed Summary/ Background)`) %>%
  rename("Narrative" = `Narrative (Detailed Summary/ Background)`)
```    

We create the **The Data** page. 

```
Column {data-width=700}
-------------------------------------

The data is from the K-12 school shooting database. This database was compiled using several steps to identify and authenticate incidents. Methods are outlined [here](https://www.chds.us/ssdb/methods/).

The database includes a codebook that defines each variable.

###
```

We then insert an interactive table. Since we have `shiny` enabled, we need to use `DF::renderDataTable` to produce the output we desire. 

```{r, eval=FALSE}
DT::renderDataTable({
  DT::datatable(DT_table,
                caption = htmltools::tags$caption(
                  style = 'caption-side: top; text-align: Left;',
                  htmltools::withTags(
                    div(HTML('<a href="https://www.chds.us/ssdb/dataset/)">Click here to be redirected to a page where this data can be downloaded.</a>')))),
                options = list(autoWidth = TRUE,
                               pageLength = 10,
                               scroller = TRUE,
                               scrollY = '450px'))
})
```

In a separate column, we will add a relevant photo to approve the visual appeal of the dashboard. Note that the width of this column is set to 300. Size specifications on `flexdashboard` are unitless; the width of any column included on a page is a function of the width set for a column against the sum of widths for all columns on that page. If we set columns sizes of 600 and 300 on a page with two columns, one column will be twice as large as the other column. 

We include a figure caption to credit the author of the photograph.

Note that there is no text next to the area where we would normally specify a header. In this case, no header is necessary for this content. `flexdashboard` & `RMarkdown` recognize this and removes the header option. 

```
Column {data-width=300}
-------------------------------------

###

'''{r, echo=FALSE, fig.cap="[Photograph by Rubén Rodriguez](https://unsplash.com/photos/IXTvnOOSTyU)", out.width = '100%'}
knitr::include_graphics("ruben-rodriguez-IXTvnOOSTyU-unsplash.jpg")
'''
```

Let's create a page for **US Statistics** we would like to share. 

```
US Statistics {data-icon="fa-flag"}
===================================== 
```

Let's create a column. Note the `.tabset` and `.tabset-fade` options specified for the column. 

```
Column {data-width=700 .tabset .tabset-fade}
-------------------------------------
```

After having specified the `.tabset` and `.tabset-fade` options, we can create each tab in the same way we would create columns. 

```
### Yearly Deaths

'''{r}
shooting_data_geocoded_us <- shooting_data_geocoded %>%
    mutate(Date = as.Date(Date, format = "%m/%d/%Y")) %>%
    mutate(Date_year = year(Date)) %>%
    group_by(Date_year) %>%
    count() %>%
    ungroup()
start <- 1970
end <- 2020
shooting_data_geocoded_us %>%
    ggplot(aes(x = Date_year, y = n)) +
    geom_bar(stat = "identity", fill = "black") +
    scale_x_continuous(breaks = seq(start, end, by = 5),
                 labels = seq(start, end, by = 5),
                 limits = c(start-1, end+1)) +
    theme_minimal() +
    labs(title = "Yearly Deaths Attributable to School Shootings",
         subtitle = "United States",
         x = "School Shootings",
         y = "")
'''

### Yearly Cumulative Deaths

'''{r}
start <- 1970
end <- 2020
shooting_data_geocoded_us2 <- shooting_data_geocoded %>%
    mutate(Date = as.Date(Date, format = "%m/%d/%Y")) %>%
    mutate(Date_year = year(Date)) %>%
    group_by(Date_year) %>%
    summarize(N = n()) %>%
    ungroup() %>%
    complete(Date_year = seq(start,end,by=1)) %>%
    mutate(n_cumsum = cumsum(N))
shooting_data_geocoded_us2 %>%
    ggplot(aes(x = Date_year, y = n_cumsum)) +
    geom_bar(stat = "identity", fill = "black") +
    scale_x_continuous(breaks = seq(start, end, by = 5),
                 labels = seq(start, end, by = 5),
                 limits = c(start-1, end+1)) +
    theme_minimal() +
    labs(title = "Yearly Cumulative Deaths Attributable to School Shootings",
         subtitle = "United States",
         x = "School Shootings",
         y = "")
'''

### Deaths per Shooting

'''{r}
shooting_data_geocoded_us3 <- shooting_data_geocoded %>%
    mutate(Date = as.Date(Date, format = "%m/%d/%Y")) %>%
    mutate(Date_year = year(Date)) %>%
    group_by(`Killed (includes shooter)`) %>%
    summarize(N = n())
shooting_data_geocoded_us3 %>%
    ggplot(aes(x = `Killed (includes shooter)`, y = N)) +
    geom_bar(stat = "identity", fill = "black") +
  scale_x_continuous(breaks = seq(0,10, by = 1),
                     labels = seq(0,10, by = 1),
                     limits = c(-1,10)) +
  scale_y_continuous() +
    theme_minimal() +
    labs(title = "Deaths per School Shooting",
         subtitle = "United States",
         x = "School Shootings",
         y = "")
'''
```

We include a column for value boxes.

```
Column {data-width=300}
------------------------------------- 
```

We create the first value box. We want to display some important statistics, importantly:

+ Wounded
+ Deaths
+ Shooting Completed/Attempted Suicide
+ Median Shots Fired
+ Deaths, Shooter was Only Victim
+ Use of a Single Handgun

```
### **Wounded**
    
'''{r}
valueBox(sum(shooting_data_geocoded$Wounded, na.rm = TRUE),
         color = "white")
'''
```

We create the remaining value boxes

```
### **Deaths**

'''{r}
valueBox(sum(shooting_data_geocoded$`Killed (includes shooter)`, na.rm = TRUE),
         color = "white")
'''

### **Shooter Completed/Attempted Suicide**

'''{r}
# this needs to be wrangled in the regular data
suicide <- shooting_data_geocoded %>%
  mutate(`Suicide (or attempted suicide) by Shooter (Y/N)` = case_when(`Suicide (or attempted suicide) by Shooter (Y/N)` == "Yes" ~ TRUE,
                                                                       TRUE ~ FALSE)) %>%
  pull(`Suicide (or attempted suicide) by Shooter (Y/N)`)

suicide <- sum(suicide,
               na.rm = TRUE) / length(suicide)

# valueBox(
#   paste(
#     round(
#       mean(suicide,
#            na.rm = TRUE) * 100,
#       2),
#     "%"),
#   color = "white")

valueBox(
  paste(
    round(suicide * 100,
          2),
  "%"),
  color = "white")
'''

### **Median Shots Fired**

'''{r}
valueBox(
  round(
  median(shooting_data_geocoded$`Number of Shots Fired`,
      na.rm = TRUE),
  2),
  color = "white")
'''

### **Deaths, Shooter was Only Victim**

'''{r}
valueBox(
  paste(
    as.character(
    round(
      100 * (sum(
    ifelse(shooting_data_geocoded$`Suicide (Shooter was only victim) Y/N/ N/A` == "Y",
                TRUE,
                FALSE), na.rm = TRUE)
    /
      sum(shooting_data_geocoded$`Killed (includes shooter)`, na.rm = TRUE)),
    2)), "%"),
  color = "white")
'''

### **Use of a Single Handgun**

'''{r}
valueBox(
  paste(
    as.character(
    round(
      100 * (sum(
    ifelse(shooting_data_geocoded$`Firearm Type` == "Rifle",
                TRUE,
                FALSE), na.rm = TRUE)
    /
      length(shooting_data_geocoded$`Firearm Type`)),
    2)), "%"),
  color = "white")
'''
```

We then create the next page, **State Statistics** 

```
State Statistics {data-icon=fa-flag-checkered}
===================================== 

Column {.sidebar data-width=250}
-----------------------------------------------------------------------

'''{r}
selectInput("state_selected", label = "Select a state to explore:",
            choices = unique(map_data("state") %>%
                               filter(region!="district of columbia") %>%
                               pull(region)) %>%
              str_to_title(), selected = "Maryland")
'''

Column {data-width=750 .tabset .tabset-fade}
-----------------------------------------------------------------------

### Yearly Deaths

'''{r}
renderPlot({
  start <- 1970
  end <- 2020
  state_df <- as_tibble(cbind(state.abb, state.name))
  shooting_data_geocoded <- shooting_data_geocoded %>%
    rename("State_abb" = State) %>%
    left_join(state_df, by = c("State_abb" = "state.abb")) %>%
    rename("State" = state.name) %>%
    mutate(State = str_to_title(tolower(State))) %>%
    mutate(Date = as.Date(Date, format = "%m/%d/%Y")) # this must be applied to wrangling
  shooting_data_geocoded_f <- shooting_data_geocoded[shooting_data_geocoded$State == input$state_selected, ]
  shooting_data_geocoded_f <- shooting_data_geocoded_f %>%
    mutate(Date_year = year(Date)) %>%
    group_by(Date_year) %>%
    count() %>%
    ungroup()
  shooting_data_geocoded_f %>%
    ggplot(aes(x = Date_year, y = n)) +
    geom_bar(stat = "identity", fill = "black") +
    scale_x_continuous(breaks = seq(start, end, by = 5),
                 labels = seq(start, end, by = 5),
                 limits = c(start-1, end+1)) +
    theme_minimal() +
    labs(title = "Statewide School Shootings",
         subtitle = input$state_selected,
         x = "Yearly Deaths Attributable to School Shootings",
         y = "")
})
'''

### Yearly Cumulative Deaths

'''{r}
renderPlot({
  start <- 1970
  end <- 2020
  state_df2 <- as_tibble(cbind(state.abb, state.name))
  shooting_data_geocoded2 <- shooting_data_geocoded %>%
    rename("State_abb" = State) %>%
    left_join(state_df2, by = c("State_abb" = "state.abb")) %>%
    rename("State" = state.name) %>%
    mutate(State = str_to_title(tolower(State))) %>%
    mutate(Date = as.Date(Date, format = "%m/%d/%Y")) # this must be applied to wrangling
  shooting_data_geocoded_f2 <- shooting_data_geocoded2[shooting_data_geocoded2$State == input$state_selected, ]
  shooting_data_geocoded_f2 <- shooting_data_geocoded_f2 %>%
    mutate(Date_year = year(Date)) %>%
    group_by(Date_year) %>%
    summarize(N = n()) %>%
    ungroup() %>%
    complete(Date_year = seq(start, end, by=1),
             fill = list(N = 0)) %>%
    mutate(n_cumsum = cumsum(N))
  shooting_data_geocoded_f2 %>%
    ggplot(aes(x = Date_year, y = n_cumsum)) +
    geom_bar(stat = "identity", fill = "black") +
    scale_x_continuous(breaks = seq(start, end, by = 5),
                 labels = seq(start, end, by = 5),
                 limits = c(start-1, end+1)) +
    theme_minimal() +
    labs(title = "Yearly Cumulative Deaths Attributable to School Shootings",
         subtitle = input$state_selected,
         x = "School Shootings",
         y = "")
})
'''

### Deaths per Shooting

'''{r}
renderPlot({
  state_df3 <- as_tibble(cbind(state.abb, state.name))
  shooting_data_geocoded3 <- shooting_data_geocoded %>%
    rename("State_abb" = State) %>%
    left_join(state_df3, by = c("State_abb" = "state.abb")) %>%
    rename("State" = state.name) %>%
    mutate(State = str_to_title(tolower(State)))
  shooting_data_geocoded3 <- shooting_data_geocoded3 %>%
    mutate(Date = as.Date(Date, format = "%m/%d/%Y")) %>%
    mutate(Date_year = year(Date)) %>%
    group_by(State,`Killed (includes shooter)`) %>%
    summarize(N = n())
  shooting_data_geocoded_f3 <- shooting_data_geocoded3[shooting_data_geocoded3$State == input$state_selected, ]
  shooting_data_geocoded_f3 %>%
    ggplot(aes(x = `Killed (includes shooter)`, y = N)) +
    geom_bar(stat = "identity", fill = "black") +
  scale_x_continuous(breaks = seq(0,30, by = 1),
                     labels = seq(0,30, by = 1),
                     limits = c(-1,30)) +
  scale_y_continuous() +
    theme_minimal() +
    labs(title = "Deaths per School Shooting",
         subtitle = input$state_selected,
         x = "School Shootings",
         y = "")
})
'''
```

We then create the **Map** page. 

```
Column {data-width=1000}
------------------------------------- 
    
### 
    
'''{r}
# would be a great idea to add a slider here if possible
# good site for icons https://iconarchive.com/

shooting_information0 <- paste('<div style="height:auto;line-height:1em;overflow:visible;padding:5px;">',
                              shooting_data_geocoded$Date,
                              "<b>",
                              shooting_data_geocoded$School,
                              "</b>",
                              shooting_data_geocoded$`Narrative (Detailed Summary/ Background)`,
                              "</div>",
                              sep = "<br/>"
)

# icon_set <- icons(
#   iconUrl = case_when(shooting_data_geocoded$`Firearm Type`=="Handgun" ~ "https://icons.iconarchive.com/icons/icons8/windows-8/48/Military-Gun-icon.png",
#                       shooting_data_geocoded$`Firearm Type`=="Rifle" ~ "https://icons.iconarchive.com/icons/icons8/windows-8/48/Military-Rifle-icon.png",
#                       TRUE ~ "https://icons.iconarchive.com/icons/dryicons/aesthetica-2/48/page-search-icon.png"),
#   iconWidth = 20,
#   iconHeight = 20
# )

leaflet(shooting_data_geocoded) %>%
  addProviderTiles(provider = providers$OpenStreetMap, group = "OpenStreetMap") %>%
  addProviderTiles(provider = providers$Esri.WorldImagery, group = "ESRI World Imagery") %>%
  addProviderTiles(provider = providers$Stamen.TonerLite, group = "Toner Lite") %>%
  addCircleMarkers(popup = ~shooting_information0,
                   lng = ~longitude,
                   lat = ~latitude,
    radius = 5,
    color = "red",
    fillOpacity = 0.2,
    stroke = TRUE,
    clusterOptions = markerClusterOptions(),
    group = "Circles") %>%
  # addMarkers(lng = ~longitude,
  #                  lat = ~latitude,
  #            popup = ~shooting_information0,
  #                  icon = icon_set,
  #                  group = "TESTER") %>%
  addMiniMap(tiles = providers$Stamen.Toner,
             toggleDisplay = TRUE,
             minimized = FALSE) %>%
  addLayersControl(
    baseGroups = c("Toner Lite",
                   "OpenStreetMap",
                   "ESRI World Imagery"),
    overlayGroups = c("Circles"),
    # overlayGroups = c("Circles", "TESTER"),
    options = layersControlOptions(collapsed = TRUE)
  ) %>%
  setView(lng = -98.35, lat = 39.5, zoom = 4)
# hideGroup(c("Circles", "TESTER"))
# need to jitter coordinates by a few meters for repeats
'''
```

We then create the **About** page.

```
About {data-icon="fa-question-circle"}
===================================== 

Column {data-width=700}
-------------------------------------

###

**What is the purpose of this dashboard?**

This dashboard has two purposes:

+ Illustrate trends in school shootings
+ Demonstrate how to create a dashboard using `R`

**I want to learn how to create a dashboard just like this.**

Visit the *Tutorial* page of this dashboard to first learn the basics about building a dashboard.

At the end of the tutorial we provide a link to this [supplementary resource by the Open Case Studies project](INCLUDE LINK HERE).

We have included the source code (see upper right-hand corner) in this dashboard for more experienced `R` users looking to mimic some of what we did in this dashboard in their own.

**Disclaimer**

The purpose of the [Open Case Studies](https://opencasestudies.github.io){target="_blank"} project is **to demonstrate the use of various data science methods, tools, and software in the context of messy, real-world data**.

A given case study does not cover all aspects of the research process, is not claiming to be the most appropriate way to analyze a given data set, and should not be used in the context of making policy decisions without external consultation from scientific experts. 

Column {data-width=300}
-------------------------------------

###

'''{r, echo=FALSE, fig.cap="[Photograph by Rubén Rodriguez](https://unsplash.com/photos/IXTvnOOSTyU)", out.width = '100%'}
knitr::include_graphics("nathan-dumlao-xPHmmVKS8lM-unsplash.jpg")
'''
```

We create a **Tutorial** page that links to this resource. 

```
Tutorial {.storyboard data-icon="fa-list-ol"}
=========================================   

### **1)** Load the `flexdashboard` package.

Install the package if you don't have the package installed already

'''{r, echo=TRUE, eval=FALSE}
install.packages("flexdashboard")
install.packages("shiny")
'''

Once installed, the package is ready to be loaded into the `R` environment.

'''{r, echo=TRUE}
library(flexdashboard)
library(shiny)
'''

This all needs to be done separately in the `R` console.

### **2)** Create an `RMD` document.   

Dashboards can be created with `flexdashboard` in the `HTML` format. 

`flexdashboard` uses `RMarkdown` to produce dashboards that can contain `R` output.

This makes it possible to include several mediums in our dashboard such as plots created with `ggplot` or maps created with `leaflet`.
    
### **3)** Create an appropriate `YAML`.

The use of `flexdashboard` alters the way `RMarkdown` documents function. These altered functions are largely dependent on the metadata we use to produce the dashboard. Metadata for the dashboard can be configured in the `YAML` of the `RMD`. 

An `HTML` document created with `RMarkdown` includes a `YAML` that is some variation of this:

'''
---
title: "Untitled"
author: "Michael Ontiveros"
date: "8/12/2020"
output: html_document
---
'''

We used the following `YAML` for this dashboard:

'''
output: 
  flexdashboard::flex_dashboard:
    logo: https://icons.iconarchive.com/icons/icons8/windows-8/48/Programming-Dashboard-icon.png
    theme: readable
    orientation: columns
    source: embed
    vertical_layout: fill
runtime: shiny
'''

We introduce an icon, provide a theme with a color scheme, define the orientation (and thus order) of coded output, include the code used, limit scrolling, and allow `shiny` widgets to be used.

### **4)** Design the layout of the dashboard.

Dashboards are inherently visual, making this step the most time intensive after content creation. We need to present the data in a way that is both meaning and visually appealing.

On this dashboard, we wanted to present static plots of the United States and of individual states. We also wanted to display the locations of school shootings and provide some information about school shootings. Aside from being a dashboard, we wanted to create an educational resource that was reproducible for others. Lastly, as a sensitive topic, we wanted to raise awareness and provide information that could help others act.

Given these goals, we decided on the following page layout:

+ The Data
+ US Statistics
+ State Statistics
+ Map
+ About
+ Tutorial
+ Hotline
+ Source Code

This layout ensured that we did to not include too many components.

The first page gives users to the opportunity to look at the data themselves. More complicated components such as the map of each incident were left alone on a single page. US and state-level statistics were separated from one another. This short tutorial on how to create the dashboard and source code were included in the dashboard with programmers at all levels in mind. The goals of the dashboard and actionable information were each given separate pages from the output. 

For your dashboard, this may take as long as the output you would like to share took you to produce. 

### **5)** Add content to the dashboard.

You can begin adding content to the dashboard once you have an initial layout in mind. Keep in mind that this will likely be an iterative process. 

The `RMarkdown` file used to create a dashboard with `flexdashboard` works similarly to any other `RMarkdown`. There are some exceptions.

'''{r, echo = TRUE}
# This output was created with chunk options: {r, echo = TRUE}
paste("Code chunks can be explicitly included")
'''

'''{r}
# This output was created with chunk options: {r}
paste("Code chunks are hidden by default")
'''

Pages and columns within pages can be defined.

'''
Page
=========================================   

Column {data-width=500}
-------------------------------------

Column {data-width=500}
-------------------------------------
'''

As mentioned before, the `flexdashboard` metadata included in the `YAML` does also alter how `RMarkdown` functions. For more on how you can leverage both `RMarkdown` and `flexdashboard` to produce a dashboard, click [here](https://rmarkdown.rstudio.com/flexdashboard/index.html).

This [supplementary resource by the Open Case Studies project](INCLUDE LINK HERE) provides a case study on how to create this very dashboard in more detail.
```

Lastly, we create a **Hotline** page to spread awareness.

```
Hotline {data-icon="fa-exclamation-triangle"}
=========================================   

Column {data-width=600}
-------------------------------------

###

**Warning Signs**

From [Sandy Hook Promise](https://www.sandyhookpromise.org/gun-violence/know-the-signs-of-gun-violence/)...

avocado... there were some really interesting things here... but dont know where/if to include
https://www.sandyhookpromise.org/gun-violence/16-facts-about-gun-violence-and-school-shootings/

The most important seems to be that shooters usually warn someone

<style>
div.blue { background-color:#e6f0ff; border-radius: 5px; padding: 20px;}
</style>
<div class = "blue">

Here is a list of potential warning signs that can signal an individual may be in crisis and/or need help:

+ Suddenly withdrawing from people and activities
+ Consistent bullying or intimidating others, or being bullied by others
+ Extreme mood or personality changes
+ Victim of constant social rejection
+ Talking about plans or actively making plans to harm themselves or others
+ Bringing a weapon to school – or threatening or talking about doing so
+ Bragging about or warning others about an upcoming act of violence
+ Recruiting others to join in a planned act of violence
+ Warning students to stay away from school or events
+ Expressing fascination with guns and/or school shootings
+ Expressing hopelessness about the future
+ Extreme, prolonged sadness or distress
+ Expressing or showing feelings of isolation
+ Bragging about access to guns

**NOTE**

This list is not a comprehensive list of warning signs nor does exhibiting one of these signs indicate imminent violence.

When concerned about seeing troubling behaviors, tell a trusted adult or call 911, if there is an immediate threat.

</div>

Column {data-width=400}
-------------------------------------

### 

**Respond to Warning Signs**

Call 911 if you feel there is an immediate threat. 

Call [+1-844-5-SAYNOW](tel:18445729669) if you would to submit an anonymous safety concern.
```

## **Summary**
*** 

### Summary Plot

### Synopsis

## **Suggested Homework**
*** 

Create another dashboard with graphs and statistics featuring other elements within this dataset. For example, students may create graphs that explore what school events are reported to have more shootings.


## **Additional Information**
***

### Helpful Links

[RStudio](https://rstudio.com/products/rstudio/features/){target="_blank"}  
[Cheatsheet on RStuido IDE](https://github.com/rstudio/cheatsheets/raw/master/rstudio-ide.pdf){target="_blank"}  
[Other RStudio cheatsheets](https://rstudio.com/resources/cheatsheets/){target="_blank"}   
[Tidyverse](https://www.tidyverse.org/){target="_blank"}   

[Response bias](https://en.wikipedia.org/wiki/Response_bias)  
[Cross-Sectional data](https://en.wikipedia.org/wiki/Cross-sectional_data?oldformat=true)
[Population](https://en.wikipedia.org/wiki/Population?oldformat=true)
[Sample](https://en.wikipedia.org/wiki/Sampling_(statistics)?oldformat=true)
[Sampling methods](https://en.wikipedia.org/wiki/Sampling_(statistics)?oldformat=true){target="_blank"} 
[Inference](https://www.britannica.com/science/inference-statistics) 

[American Community Survey (ASC)](https://www.census.gov/programs-surveys/acs)  

See [here](https://en.wikipedia.org/wiki/American_Community_Survey) for more detailed information about the survey  
[Measure of America](https://www.ssrc.org/programs/view/moa/)   
[Social Science Research Council](https://www.ssrc.org/) 
   

[Piping in R](https://cran.r-project.org/web/packages/magrittr/vignettes/magrittr.html){target="_blank"}   
[Writing functions](https://r4ds.had.co.nz/functions.html)   
Also see [this case study](https://opencasestudies.github.io/ocs-bloomberg-vaping-case-study/){target="_blank"}  for more information on writing functions.   
[String manipulation cheatsheet](https://rstudio.com/resources/cheatsheets/){target="_blank"}  
[Table formats](https://en.wikipedia.org/wiki/Wide_and_narrow_data){target="_blank"}

[Regression](https://lindeloev.github.io/tests-as-linear/)    
[simple linear regression](https://en.wikipedia.org/wiki/Simple_linear_regression)   
[monotonic association](https://www.statisticshowto.com/monotonic-relationship/)   
[Kendall rank correlation coefficient](https://en.wikipedia.org/wiki/Kendall_rank_correlation_coefficient?oldformat=true)   
[Null hypothesis](https://en.wikipedia.org/wiki/Null_hypothesis)   
[Alternative hypothesis](https://en.wikipedia.org/wiki/Alternative_hypothesis)   
[Probability](https://en.wikipedia.org/wiki/Probability)   
[one-sided and two-sided hypotheses](https://en.wikipedia.org/wiki/One-_and_two-tailed_tests)   
[Nonparametric](https://en.wikipedia.org/wiki/Nonparametric_statistics)     [Parametric](https://en.wikipedia.org/wiki/Parametric_statistics) 
[significance threshold](https://en.wikipedia.org/wiki/Statistical_significance)  
[Z score](https://en.wikipedia.org/wiki/Standard_score)   
[Z score table](https://socratic.org/questions/5986a3e1b72cff6fd48a5408)  
[Z score to p-value calculator](https://www.socscistatistics.com/pvalues/normaldistribution.aspx)   


[`ggplot2` package](http://ggplot2.tidyverse.org){target="_blank"}    
Please see [this case study](https://opencasestudies.github.io/ocs-bp-co2-emissions/)  for more details on using `ggplot2`    
[grammar of graphics](http://vita.had.co.nz/papers/layered-grammar.html){target="_blank"}   
[`ggplot2` themes](https://ggplot2.tidyverse.org/reference/ggtheme.html){target="_blank"}   
[`directlabels` package methods](http://directlabels.r-forge.r-project.org/docs/index.html){target="_blank"}    
[Hmong people](https://en.wikipedia.org/wiki/Hmong_people)   
[Intersections](https://www.vox.com/the-highlight/2019/5/20/18542843/intersectionality-conservatism-law-race-gender-discrimination)   

[Motivating article for this case study about youth disconnection/opportunity youth](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6243446/)


To learn more about importing and wrangling PDFs using the `pdftools` package see this [case study](https://opencasestudies.github.io/ocs-bp-rural-and-urban-obesity/) and this [case study](https://opencasestudies.github.io/ocs-bp-rural-and-urban-obesity/). 

To learn more about what you can do with the `magick` package see this [vingette](https://cran.r-project.org/web/packages/magick/vignettes/intro.html).   

To learn more about the **Mann-Kendall trend test** see
[here](https://www.statisticshowto.com/mann-kendall-trend-test/) and [here](https://www.statisticshowto.com/wp-content/uploads/2016/08/Mann-Kendall-Analysis-1.pdf).  

To learn more about hypothesis testing, see this [case study](https://opencasestudies.github.io/ocs-bp-rural-and-urban-obesity/).    


<u>**Packages used in this case study:** </u>

Package   | Use in this case study                                                                      
---------- |-------------
[here](https://github.com/jennybc/here_here){target="_blank"}       | to easily load and save data  
[pdftools](https://readr.tidyverse.org/)      | to import PDF documents  
[magick](https://cran.r-project.org/web/packages/magick/vignettes/intro.html#Kernel_convolution)      | for importing images and extracting text from images   
[knitr](https://yihui.org/knitr/) |  for showing images in reports    
[dplyr](https://dplyr.tidyverse.org/){target="_blank"}      | to filter, subset, join, add rows to, and modify the data   
[stringr](https://stringr.tidyverse.org/){target="_blank"}      | to manipulate strings  
[magrittr](https://magrittr.tidyverse.org/){target="_blank"}      | to pipe sequential commands 
[tidyr](https://tidyr.tidyverse.org/){target="_blank"}      | to change the shape or format of tibbles to wide and long, to drop rows with `NA` values, to separate a column into additional columns, and to fill out values based on previous values   
[tibble](https://tibble.tidyverse.org/){target="_blank"}      | to create tibbles    
[ggplot2](https://ggplot2.tidyverse.org/){target="_blank"}      | to create plots  
[directlabels](http://directlabels.r-forge.r-project.org/docs/index.html){target="_blank"}      | to add labels directly to lines in plots  
[cowplot](https://cran.r-project.org/web/packages/cowplot/vignettes/introduction.html){target="_blank"}      | to add images to plots 
[forcats](https://forcats.tidyverse.org/){target="_blank"}      | to reorder factor for plot
[kendall](https://cran.r-project.org/web/packages/Kendall/Kendall.pdf) | to implement the Mann-Kendall trend test in R   
[patchwork](https://github.com/thomasp85/patchwork) | to combine plots

#### {.emphasis_block}

**Warning Signs**

From [Sandy Hook Promise](https://www.sandyhookpromise.org/gun-violence/know-the-signs-of-gun-violence/)...

Here is a list of potential warning signs that can signal an individual may be in crisis and/or need help:

+ Suddenly withdrawing from people and activities
+ Consistent bullying or intimidating others, or being bullied by others
+ Extreme mood or personality changes
+ Victim of constant social rejection
+ Talking about plans or actively making plans to harm themselves or others
+ Bringing a weapon to school – or threatening or talking about doing so
+ Bragging about or warning others about an upcoming act of violence
+ Recruiting others to join in a planned act of violence
+ Warning students to stay away from school or events
+ Expressing fascination with guns and/or school shootings
+ Expressing hopelessness about the future
+ Extreme, prolonged sadness or distress
+ Expressing or showing feelings of isolation
+ Bragging about access to guns

**NOTE**

This list is not a comprehensive list of warning signs nor does exhibiting one of these signs indicate imminent violence.

When concerned about seeing troubling behaviors, tell a trusted adult or call 911, if there is an immediate threat.

**Respond to Warning Signs**

Call 911 if you feel there is an immediate threat. 

Call [+1-844-5-SAYNOW](tel:18445729669) if you would to submit an anonymous safety concern.


If you or your child or student experienced a shooting please see this [website](https://kidshealth.org/en/parents/ptsd.html) and this [website](https://www.verywellmind.com/shooting-ptsd-from-a-shooting-2797200) for guidance about dealing with the trauma.


####

### Session Info

```{r}
sessionInfo()
```


### Acknowledgements

We would like to acknowledge [Elizabeth Stuart](https://www.jhsph.edu/faculty/directory/profile/1792/elizabeth-a-stuart) for assisting in framing the major direction of the case study.

We would also like to acknowledge the [Bloomberg American Health Initiative](https://americanhealth.jhu.edu/) for funding this work. 

